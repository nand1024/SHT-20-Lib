Моя проста бібліотека для сенсору sht-20.

Для її використання необхідно самому створити 2 функції для взаємодії з i2c. Типу таких (фрагменти коду взяті з одного з моїх проектів).

i2c_op_res i2c_read255 (uint8_t adress, uint8_t *reg_adr, uint8_t size_reg_adr, uint8_t *data, uint32_t size)

i2c_op_res i2c_write255 (uint8_t adress, uint8_t *reg_adr, uint8_t size_reg_adr, uint8_t *data, uint32_t size)

Де:

i2c_op_res   це enm з результатами роботи i2c.

typedef enum {
    
    i2c_op_succes,      // успіх. по факту перевіряється лише цей стан, список інших можна звузити до одного простого i2c_op_err.
    
    i2c_op_err_arg,
    
    i2c_op_err_start,
    
    i2c_op_err_restart,
    
    i2c_op_err_nack,
    
    i2c_op_err_timeout,

} i2c_op_res;

adress       адреса пристрою без зміщення( << 1).

reg_adr      адреса регістру.

size_reg_adr розмір адреси регістру, для конкретно цієї бібліотеки це може бути зайвим, але її використовують мої модулі i2c для яких цей параметр може мати значення.

data*        масив даних на прийом або відправку.

size         розмір масиву даних.

Далі створюємо структуру з колбеками.

  SHT20CB sht20CB = {

        .i2c_read = i2c_read255,
        
        .i2c_write = i2c_write255,
  
  };

Створюємо змінні.

float now_temp; //значення температури

float now_hum;  //значення вологості

або для цілочислених зміних (можна налаштувати дефайном SHT20_DOUBLE_CALC в sht20.h).

int16_t now_temp;

int16_t now_hum;

Тепер можемо отримувати виміри температури та вологості за допомогою функції.

sht20_get_data(&sht20CB, &now_temp, &now_hum);


У випадку використання для цілочислених зміних, температура виду 18.25 буде у вигляді 1825. це може бути корисним для економії ресурсів в мк без аппаратної підтримки обчислень з плаваючою точкою.






